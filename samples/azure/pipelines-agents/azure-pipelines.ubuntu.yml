parameters:
  version: ''

jobs:
  - job: ubuntu_${{ replace(parameters.version, '.', '_') }}
    displayName: Ubuntu ${{ parameters.version }}

    pool:
      vmImage: 'ubuntu-${{ parameters.version }}'

    steps:
      - checkout: none

      - script: |
          uname -a
          lsb_release -a

          lscpu
          lsmem
          sudo lshw -short
        displayName: Initialize System

      - script: |
          sudo rm -Rf /usr/local/lib/android
          sudo rm -Rf /usr/local/lib/node_modules

          df -h
        displayName: Initialize Disk

      - script: |
          apt list --installed
        displayName: Initialize Apps

      - script: |
          curl -Ls https://gist.github.com/gusztavvargadr/1f0d7dddc7f48549368eaaedf19bfe55/raw/deploy.sh | sudo POLICY_NAME="chef-workstation" bash -s
        displayName: Provision

      - script: |
          chef-client --version
          chef --version
        displayName: Test
