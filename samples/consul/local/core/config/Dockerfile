ARG TERRAFORM_IMAGE_NAME
ARG TERRAFORM_VERSION

ARG CONSUL_TEMPLATE_IMAGE_NAME
ARG CONSUL_TEMPLATE_VERSION

ARG CONSUL_IMAGE_NAME
ARG CONSUL_VERSION

ARG VAULT_IMAGE_NAME
ARG VAULT_VERSION

FROM ${CONSUL_TEMPLATE_IMAGE_NAME}:${CONSUL_TEMPLATE_VERSION} as consul-template

FROM ${CONSUL_IMAGE_NAME}:${CONSUL_VERSION} AS consul

FROM ${VAULT_IMAGE_NAME}:${VAULT_VERSION} AS vault

FROM ${TERRAFORM_IMAGE_NAME}:${TERRAFORM_VERSION}
COPY --from=consul-template /bin/consul-template /bin/
COPY --from=consul /bin/consul /bin/
COPY --from=vault /bin/vault /bin/

ADD ./*.hcl ./
ADD ./run.sh ./
